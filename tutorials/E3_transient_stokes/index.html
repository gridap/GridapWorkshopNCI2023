<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <script src="/GridapWorkshopNCI2023/libs/lunr/lunr.min.js"></script> <script src="/GridapWorkshopNCI2023/libs/lunr/lunr_index.js"></script> <script src="/GridapWorkshopNCI2023/libs/lunr/lunrclient.min.js"></script> <link rel=stylesheet  href="/GridapWorkshopNCI2023/libs/katex/katex.min.css"> <link rel=stylesheet  href="/GridapWorkshopNCI2023/libs/highlight/github.min.css"> <link rel=stylesheet  href="/GridapWorkshopNCI2023/css/franklin.css"> <link rel=stylesheet  href="/GridapWorkshopNCI2023/css/poole_hyde.css"> <link rel=stylesheet  href="/GridapWorkshopNCI2023/css/custom.css"> <style> html {font-size: 17px;} .franklin-content {position: relative; padding-left: 8%; padding-right: 5%; line-height: 1.35em;} @media (min-width: 940px) { .franklin-content {width: 100%; margin-left: auto; margin-right: auto;} } @media (max-width: 768px) { .franklin-content {padding-left: 6%; padding-right: 6%;} } </style> <link rel=apple-touch-icon  sizes=152x152  href="/GridapWorkshopNCI2023/assets/favicon/apple-touch-icon.png"> <link rel=icon  type="image/png" sizes=32x32  href="/GridapWorkshopNCI2023/assets/favicon/favicon-32x32.png"> <link rel=icon  type="image/png" sizes=16x16  href="/GridapWorkshopNCI2023/assets/favicon/favicon-16x16.png"> <link rel=manifest  href="/GridapWorkshopNCI2023/assets/favicon/site.webmanifest"> <link rel=mask-icon  href="/GridapWorkshopNCI2023/assets/favicon/safari-pinned-tab.svg" color="#5bbad5"> <meta name=msapplication-TileColor  content="#da532c"> <meta name=theme-color  content="#ffffff"> <title>Transient Stokes tutorial</title> <style> .content {max-width: 60rem} </style> <div class=sidebar > <div class="container sidebar-sticky"> <div class=sidebar-about > <img src="/GridapWorkshopNCI2023/assets/logos.png" style="width: 500px; height: auto; display: inline"> <div style="font-weight: margin-bottom: 0.5em"><a href="/GridapWorkshopNCI2023/">28-29th, November, 2023</a> <span style="opacity: 0.9;">| Australian National University, Canberra</span></div> <br> <h1><a href="/GridapWorkshopNCI2023/">Introduction to Gridap: Simulating PDEs using finite elements in Julia</a></h1> <div style="line-height:18px; font-size: 15px; opacity: 0.85">by &nbsp; <a href="https://research.monash.edu/en/persons/santiago-badia">Santiago Badia</a>, &nbsp; <a href="https://amartinhuertas.github.io/">Alberto F. Martin</a>, &nbsp; <a href="https://github.com/JordiManyer">Jordi Manyer</a> </div> </div> <br> <style> </style> <nav class=sidebar-nav  style="opacity: 0.9; margin-bottom: 1.2cm;"> <a class="sidebar-nav-item " href="/GridapWorkshopNCI2023/"><b>Welcome</b></a> <a class="sidebar-nav-item " href="/GridapWorkshopNCI2023/software_install/">Software install instructions</a> <a class="sidebar-nav-item " href="/GridapWorkshopNCI2023/tutorials/">Tutorials</a> <a class="sidebar-nav-item " href="/GridapWorkshopNCI2023/references/">References</a> <a class="sidebar-nav-item " href="/GridapWorkshopNCI2023/grants/">Registration and grants for research students</a> <a class="sidebar-nav-item " href="/GridapWorkshopNCI2023/flyer/">Event Flyer</a> <br> <div class=course-section >Part 1 - Introduction to the finite element method</div> <a class="sidebar-nav-item " href="/GridapWorkshopNCI2023/lecture1/">Tutorial 1 - TBA</a> <div class=course-section >Part 2 - TBA</div> <div class=course-section >Part 3 - TBA</div> </nav> <form id=lunrSearchForm  name=lunrSearchForm > <input class=search-input  name=q  placeholder="Enter search term" type=text > <input type=submit  value=Search  formaction="/GridapWorkshopNCI2023/search/index.html"> </form> <br> <br> </div> </div> <div class="content container"> <div class=franklin-content > <h1 id=transient_stokes_tutorial ><a href="#transient_stokes_tutorial" class=header-anchor >Transient Stokes tutorial</a></h1> <p>In this <strong>exercise</strong>, we will learn</p> <ul> <li><p>How to solve transient multi-field PDEs in Gridap</p> </ul> <h2 id=problem_statement ><a href="#problem_statement" class=header-anchor >Problem statement</a></h2> <p>We consider now as model problem the transient Stokes equations. We will assume the solution of the problem is given by the velocity \(u(x,t) = t(x_1,x_2)^T\) and pressure \(p(x,t) = t(x_1-x_2)\). Thus, the PDE we want to solve is: find the velocity vector \(u\) and the pressure \(p\) such that</p> <pre><code class=language-math >\left\lbrace
\begin&#123;aligned&#125;
\frac&#123;\partial u&#40;t&#41;&#125;&#123;\partial t&#125; - \Delta u&#40;t&#41; &#43; \nabla p &amp;&#61; f&#40;t&#41; &amp; \text&#123; in &#125;\Omega, \\
\nabla \cdot u&#40;t&#41; &amp;&#61; g&#40;t&#41; &amp; \text&#123; in &#125; \Omega, \\
u&#40;x,t&#41; &amp;&#61; t&#40;x_1,x_2&#41;^T &amp; \text&#123; on &#125; \partial\Omega, \\
u&#40;x,0&#41; &amp;&#61; 0.0 &amp; \text&#123; in &#125; \Omega, \\
p&#40;x,0&#41; &amp;&#61; 0.0 &amp; \text&#123; in &#125; \Omega,
\end&#123;aligned&#125;
\right.</code></pre> <p>where the computational domain is the unit square \(\Omega \doteq (0,1)^d\), \(d=2\), and \(f\) and \(g\) are the source terms that can be easily computed from the expressions of \(u\) and \(p\).</p> <p>We impose Dirichlet boundary conditions for the velocity on the entire boundary \(\partial\Omega\) and constrain the mean value of the pressure to zero in order have a well-posed problem.</p> <h2 id=numerical_scheme ><a href="#numerical_scheme" class=header-anchor >Numerical scheme</a></h2> <p>In order to approximate this problem <strong>in space</strong> we chose a formulation based on inf-sub stable \(\boldsymbol{Q}_k/Q_{k-1}\) elements with continuous velocities and pressure pairs, the so called Taylor-Hood FEs. The interpolation spaces are defined as follows. The velocity interpolation space is</p> <pre><code class=language-math >V \doteq \&#123; v \in &#91;C^0&#40;\Omega&#41;&#93;^d:\ v|_T\in &#91;Q_k&#40;T&#41;&#93;^d \text&#123; for all &#125; T\in\mathcal&#123;T&#125; \&#125;,</code></pre>
<p>where \(T\) denotes an arbitrary cell of the FE mesh \(\mathcal{T}\), and \(Q_k(T)\) is the local polynomial space in cell \(T\) defined as the multi-variate polynomials in \(T\) of order less or equal to \(k\) in each spatial coordinate. This is the usual continuous vector-valued Lagrangian FE space of order \(k\) defined on a mesh of quadrilaterals or hexahedra. Likewise, the space for the pressure is</p>
<pre><code class=language-math >\begin&#123;aligned&#125;
Q_0 &amp;\doteq \&#123; q \in Q: \  \int_\Omega q \ &#123;\rm d&#125;\Omega &#61; 0\&#125;, \text&#123; with&#125;\\
Q &amp;\doteq \&#123; q \in C^0&#40;\Omega&#41; :\ q|_T\in Q_&#123;k-1&#125;&#40;T&#41; \text&#123; for all &#125; T\in\mathcal&#123;T&#125;\&#125;,
\end&#123;aligned&#125;</code></pre>
<p>where functions in \(Q_0\) are strongly constrained to have zero mean value.</p>
<p>The weak form of the problem reads: find \((u,p) \in U_g(t) \times Q_0\) such that</p>
<pre><code class=language-math >m&#40;t,&#40;u,p&#41;,&#40;v,q&#41;&#41; &#43; a&#40;t,&#40;u,p&#41;,&#40;v,q&#41;&#41; &#61; b&#40;t,&#40;v,q&#41;&#41; \quad \forall &#40;v,q&#41; \in \ V_0 \times Q_0</code></pre>
<p>where \(U_g(t)\) and \(V_0\) are the set of functions in \(V\) fulfilling the Dirichlet boundary condition \(g(t)\) and \(0\) on \(\partial\Omega\) respectively. Here, \(U_g(t)\) is a transient FE space, in the sense that the Dirichlet boundary value of functions in \(U_g\) changes in time. The definition of \(m(t,(u,p),(v,q))\), \(a(t,(u,p),(v,q))\) and \(b(t,(v,q))\) is as follows.</p>
<pre><code class=language-math >\begin&#123;aligned&#125;
m&#40;t,&#40;u,p&#41;,&#40;v,q&#41;&#41; &amp;&#61; \int_\Omega \frac&#123;\partial u&#125;&#123;\partial t&#125; v \ d\Omega, \\
a&#40;t,&#40;u,p&#41;,&#40;v,q&#41;&#41; &amp;&#61; \int_&#123;\Omega&#125; \nabla u \cdot \nabla v \ &#123;\rm d&#125;\Omega - \int_&#123;\Omega&#125; &#40;\nabla\cdot v&#41; \ p \ &#123;\rm d&#125;\Omega &#43; \int_&#123;\Omega&#125; q \ &#40;\nabla \cdot u&#41; \ &#123;\rm d&#125;\Omega, \\
b&#40;t,&#40;v,q&#41;&#41; &amp;&#61; \int_\Omega f&#40;t&#41; \cdot v \ d\Omega &#43; \int_\Omega g&#40;t&#41; \ q \ d\Omega
\end&#123;aligned&#125;</code></pre>
<h2 id=creating_the_discrete_model ><a href="#creating_the_discrete_model" class=header-anchor >Creating the discrete model</a></h2>
<p>We start with the discretization of the computational domain. We consider a \(50\times50\) Cartesian grid of the unit square.</p>
<h3 id=exercise_1 ><a href="#exercise_1" class=header-anchor >Exercise 1</a></h3>
<p><em>Load Gridap and create a \(50\times50\) Cartesian grid of the unit square.</em></p>
<pre><code class=language-julia ># Solution of exercise 1</code></pre>
<h2 id=setting_up_multifield_fe_spaces ><a href="#setting_up_multifield_fe_spaces" class=header-anchor >Setting up multifield FE spaces</a></h2>
<h3 id=exercise_2 ><a href="#exercise_2" class=header-anchor >Exercise 2</a></h3>
<p><em>Create the test FE spaces of the problem.</em></p>
<p><em>For the velocities, we need to create the standard vector-valued continuous Lagrangian test FE space of order \(k\). For the pressures, the standard scalar-valued continuous Lagrangian test FE space of order \(k-1\) with zero mean value. We choose k &#61; 2.</em></p>
<p><strong>Hints:</strong></p>
<ul>
<li><p>The spaces of test functions are constant in time and are defined as in steady problems.</p>

<li><p>Use the tag <code>boundary</code> to set up Dirichlet BCs for the velocity everywhere on the boundary \(\partial \Omega\).</p>

</ul>
<pre><code class=language-julia ># Solution of exercise 2</code></pre>
<p>The trial space of the velocities is now a <code>TransientTrialFESpace</code>, which is constructed from a <code>TestFESpace</code> and a time-dependent function for the Dirichlet boundary condition.</p>
<pre><code class=language-julia >u&#40;x,t::Real&#41; &#61; t*VectorValue&#40;x&#91;1&#93;,x&#91;2&#93;&#41;
u&#40;t::Real&#41; &#61; x -&gt; u&#40;x,t&#41;

U &#61; TransientTrialFESpace&#40;V,u&#41;</code></pre>
<p>We need to provide \(u\) overloaded with two methods: &#40;1&#41; A function that evaluates \(u\) at a given \((x,t)\) pair &#40;needed, e.g., to output the solution&#41; and &#40;2&#41; \(u\) with the time argument only, such that it returns the space-only function for a given \(t\) &#40;needed, e.g., to compute the time derivative of \(u\)&#41;.</p>
<p>Meanwhile, there is no time derivative operator acting on the pressure. Therefore, the pressure space is constant in time, and thus, defined as in steady problems.</p>
<pre><code class=language-julia >P &#61; TrialFESpace&#40;Q&#41;</code></pre>
<p>With all these ingredients we create the FE spaces representing the Cartesian product of the velocity and pressure FE spaces, i.e. the multifield FE space where we are seeking the solution the problem. The trial multifield FE space must be a transient one, since <code>U</code> is a transient FE space.</p>
<pre><code class=language-julia >Y &#61; MultiFieldFESpace&#40;&#91;V, Q&#93;&#41;
X &#61; TransientMultiFieldFESpace&#40;&#91;U, P&#93;&#41;</code></pre>
<h2 id=triangulation_and_integration_quadrature ><a href="#triangulation_and_integration_quadrature" class=header-anchor >Triangulation and integration quadrature</a></h2>
<p>We define the triangulation and integration measure from the discrete model as usual:</p>
<pre><code class=language-julia >degree &#61; 2*order
Ωₕ &#61; Triangulation&#40;model&#41;
dΩ &#61; Measure&#40;Ωₕ,degree&#41;</code></pre>
<h2 id=defining_the_source_terms_of_the_problem ><a href="#defining_the_source_terms_of_the_problem" class=header-anchor >Defining the source terms of the problem</a></h2>
<p>Before writing down the weak form of the problem, we need to construct the time-dependent functions representing the source terms <code>f&#40;t&#41;</code> and <code>g&#40;t&#41;</code>, corresponding to the right-hand sides of the first and second equation of the problem.</p>
<p>Using the fact that the solution of the problem is \(u(x,t) = t(x_1,x_2)^T\) and the pressure is \(p(x,t) = t(x_1-x_2)\), we have that</p>
<pre><code class=language-math >f&#40;x,t&#41; &#61; \frac&#123;\partial u&#40;x,t&#41;&#125;&#123;\partial t&#125; - \Delta u&#40;x,t&#41; &#43; \nabla p &#61; &#40;x_1&#43;t,x_2-t&#41;^T \quad \text&#123;and&#125; \quad g&#40;x,t&#41; &#61; 2t,</code></pre>
<p>where we recall that the pressure is a constant. We will define <code>f&#40;x,t&#41;</code> in two equivalent ways. First, we proceed in a conventional manner:</p>
<h3 id=exercise_3 ><a href="#exercise_3" class=header-anchor >Exercise 3</a></h3>
<p><em>Write the expressions for the vector-valued function <code>f</code> and the scalar function <code>g</code> as written above. Like <code>u</code> before, they must be time-dependent functions that return a space-only function.</em></p>
<pre><code class=language-julia ># Solution of exercise 3</code></pre>
<p>Alternatively, we can use automatic differentiation to get directly <code>f</code> and <code>g</code>. In order to do that, we must define <code>p</code> before.</p>
<pre><code class=language-julia >p&#40;t::Real&#41; &#61; x -&gt; t*&#40;x&#91;1&#93;-x&#91;2&#93;&#41;

f_AD&#40;t::Real&#41; &#61; x -&gt; ∂t&#40;u&#41;&#40;t&#41;&#40;x&#41;-Δ&#40;u&#40;t&#41;&#41;&#40;x&#41;&#43; ∇&#40;p&#40;t&#41;&#41;&#40;x&#41;
g_AD&#40;t::Real&#41; &#61; x -&gt; &#40;∇⋅u&#40;t&#41;&#41;&#40;x&#41;</code></pre>
<p>We can do some quick &#40;non-exhaustive&#41; checks to compare both alternatives:</p>
<pre><code class=language-julia >@assert f&#40;1.0&#41;&#40;Point&#40;0.5,0.5&#41;&#41; &#61;&#61; f_AD&#40;1.0&#41;&#40;Point&#40;0.5,0.5&#41;&#41; &#61;&#61; VectorValue&#40;1.5,-0.5&#41;
@assert g&#40;1.0&#41;&#40;Point&#40;0.5,0.5&#41;&#41; &#61;&#61; g_AD&#40;1.0&#41;&#40;Point&#40;0.5,0.5&#41;&#41; &#61;&#61; 2.0</code></pre>
<h2 id=writing_down_the_weak_form_and_the_fe_operator_of_the_problem ><a href="#writing_down_the_weak_form_and_the_fe_operator_of_the_problem" class=header-anchor >Writing down the weak form and the FE operator of the problem</a></h2>
<p>The weak form of the problem follows the same structure as other <code>Gridap</code> tutorials, where we define the bilinear and linear forms to define the FE operator. In the most general case, we need to deal with time-dependent quantities and with the presence of time derivatives. Here, we exploit the fact that the problem is linear and use the transient Affine FE operator signature <code>TransientAffineFEOperator</code>. In that case, we handle time-dependent quantities by passing the time, \(t\), as an additional argument to the form, i.e. \(a(t,(u,p),(v,q))\). Meanwhile, we take care of the time derivative by defining \(m\) as a mass contribution.</p>
<h3 id=exercise_4 ><a href="#exercise_4" class=header-anchor >Exercise 4</a></h3>
<p><em>Write the bilinear forms <code>m</code>, <code>a</code> and the time-dependent linear form <code>b</code>. Recall that \(m\) is expressed as a mass contribution.</em></p>
<p><strong>Hint:</strong> The only variables needing an explicit time dependency are the source terms <code>f</code> and <code>g</code>.</p>
<pre><code class=language-julia ># Solution of exercise 4</code></pre>
<p>With all these ingredients we can instantiate the <code>TransientAffineFEOperator</code> as:</p>
<pre><code class=language-julia >op &#61; TransientAffineFEOperator&#40;m,a,b,X,Y&#41;</code></pre>
<h2 id=setting_up_the_transient_fe_solver ><a href="#setting_up_the_transient_fe_solver" class=header-anchor >Setting up the transient FE solver</a></h2>
<p>We have already built the transient FE problem. Now, the remaining step is to solve it. First, we define a linear solver to be used at each time step. Here we use the <code>LUSolver</code>, but other choices are possible.</p>
<pre><code class=language-julia >ls &#61; LUSolver&#40;&#41;</code></pre>
<p>Then, we define the ODE solver. That is, the scheme that will be used for the time integration. In this tutorial we use the 2nd order <code>ThetaMethod</code> &#40;\(\theta = 0.5\)&#41;.</p>
<h3 id=exercise_5 ><a href="#exercise_5" class=header-anchor >Exercise 5</a></h3>
<p><em>Define the ODE solver. Use a <code>ThetaMethod</code> with <code>ls</code> as the solver, \(dt = 0.05\) and \(\theta = 0.5\).</em></p>
<p><strong>Hint:</strong> Use <code>methods&#40;ThetaMethod&#41;</code> to get the signature of the <code>ThetaMethod</code> constructor. Note that the <code>nls</code> variable in the constructor is a <code>NonlinearSolver</code> and <code>LinearSolver &lt;: NonlinearSolver</code>.</p>
<pre><code class=language-julia ># Solution of exercise 5</code></pre>
<p>Finally, we define the solution using the <code>solve</code> function, giving the ODE solver, the FE operator, an initial solution, an initial time and a final time. To construct the initial condition we interpolate the initial velocity and pressure into the FE space \(X(t) = U(t) \times P\) at \(t = 0.0\).</p>
<pre><code class=language-julia >u₀ &#61; interpolate_everywhere&#40;u&#40;0.0&#41;,U&#40;0.0&#41;&#41;
p₀ &#61; interpolate_everywhere&#40;p&#40;0.0&#41;,P&#41;

x₀ &#61; interpolate_everywhere&#40;&#91;u₀,p₀&#93;,X&#40;0.0&#41;&#41;
t₀ &#61; 0.0
T &#61; 1.0
xₕₜ &#61; solve&#40;ode_solver,op,x₀,t₀,T&#41;</code></pre>
<h2 id=postprocessing ><a href="#postprocessing" class=header-anchor >Postprocessing</a></h2>
<p>We should highlight that <code>xₕₜ</code> is just an <em>iterable</em> function and the results at each time steps are only computed when iterating over it, i.e., lazily. We can post-process the results and generate the corresponding <code>vtk</code> files using the <code>createpvd</code> and <code>createvtk</code> functions. The former will create a <code>.pvd</code> file with the collection of <code>.vtu</code> files saved at each time step by <code>createvtk</code>. The computation of the problem solutions will be triggered in the following loop:</p>
<pre><code class=language-julia >using DrWatson
out_file &#61; datadir&#40;&quot;transient_stokes&quot;&#41;
createpvd&#40;out_file&#41; do pvd
  for &#40;xₕ,t&#41; in xₕₜ
    &#40;uₕ,pₕ&#41; &#61; xₕ
    pvd&#91;t&#93; &#61; createvtk&#40;Ωₕ,out_file*&quot;_&#36;t.vtu&quot;,cellfields&#61;&#91;&quot;uh&quot;&#61;&gt;uₕ,&quot;ph&quot;&#61;&gt;pₕ&#93;&#41;
  end
end</code></pre>
<p>And visualise them in ParaView.</p>
<h2 id=references ><a href="#references" class=header-anchor >References</a></h2>
<p><a href="https://gridap.github.io/Tutorials/dev/pages/t017_poisson_transient/#Tutorial-17:-Transient-Poisson-equation-1">Gridap Tutorial 17: Transient Poisson Equation</a></p>
<h3 id=bonus_exercises ><a href="#bonus_exercises" class=header-anchor >Bonus exercises</a></h3>
<ol>
<li><p><em>The solution of this problem belongs to the FE space, since it is linear in space and time. Hence the FE solutions <code>uₕ</code> and <code>pₕ</code> should coincide with <code>u</code> and <code>p</code> at every time step. Compute the l2 norm of the errors for <code>uₕ</code> and <code>pₕ</code> inside the iteration over <code>xₕₜ</code> and check exacteness &#40;up to arithmetical precision errors&#41;.</em></p>

<li><p><em>Write down the residual of the problem and solve it defining the operator as <code>op &#61; TransientFEOperator&#40;res,X,Y&#41;</code>, i.e. with the Jacobian computed with automatic differentiation. You might find help on how to do this in &#91;Gridap Tutorial 17: Transient Poisson Equation&#93;&#40;https://gridap.github.io/Tutorials/dev/pages/t017</em>poisson<em>transient/#Tutorial-17:-Transient-Poisson-equation-1&#41;.</em></p>

</ol>
<p><strong>Tutorial done&#33;</strong></p>

<div class=page-foot >
  <div class=copyright >
    <a href="https://github.com/gridap/GridapWorkshopNCI2023"><b>Edit this page on <img class=github-logo  src="https://unpkg.com/ionicons@5.1.2/dist/svg/logo-github.svg"></b></a><br>
    Last modified: November 19, 2023. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>.
  </div>
</div>
</div>
    </div>  
    
        <script src="/GridapWorkshopNCI2023/libs/katex/katex.min.js"></script>
<script src="/GridapWorkshopNCI2023/libs/katex/auto-render.min.js"></script>
<script>renderMathInElement(document.body)</script>

    
    
        <script src="/GridapWorkshopNCI2023/libs/highlight/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();hljs.configure({tabReplace: '    '});</script>